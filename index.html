<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Recruion AI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    #drop-area.dragover {
      border-color: #3b82f6;
      background-color: #eff6ff;
    }
    .spinner {
      border: 4px solid #e5e7eb;
      border-top: 4px solid #3b82f6;
      border-radius: 50%;
      width: 40px; height: 40px;
      animation: spin 1s linear infinite;
      margin: auto;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    #back-to-top {
      position: fixed; bottom: 2rem; right: 2rem;
      background-color: #3b82f6; color: white;
      padding: 0.75rem; border-radius: 9999px;
      display: none; z-index: 50;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    #back-to-top:hover {
      transform: scale(1.1);
      transition: all 0.2s ease;
    }
  </style>
</head>
<body class="bg-white text-gray-800 font-sans">

  <!-- Hero -->
  <section class="bg-blue-50 py-16 px-6 text-center">
    <h1 class="text-4xl md:text-5xl font-bold mb-4" id="hero-title">
      F√•r du fortfarande inga svar? <span class="text-blue-600">L√•t AI fixa det.</span>
    </h1>
    <p class="mb-6 text-lg max-w-2xl mx-auto" id="hero-sub">
      Ladda upp ditt CV och f√• direkt feedback och jobbf√∂rslag.
    </p>
  </section>

  <!-- Upload -->
  <section class="py-12 px-6 text-center">
    <h2 class="text-2xl font-bold mb-4" id="upload-title">Ladda upp ditt CV</h2>
    <form id="cv-form" class="max-w-xl mx-auto">
      <div id="drop-area"
           class="border-2 border-dashed border-gray-400 bg-white rounded-lg p-10 cursor-pointer transition">
        <p id="drop-label">Sl√§pp ditt CV h√§r eller klicka f√∂r att ladda upp</p>
        <input type="file" id="cv" name="cv" accept=".pdf,.docx" class="hidden" required/>
      </div>
      <button type="submit"
              class="mt-6 bg-blue-600 text-white px-6 py-2 rounded-md">
        Analysera mitt CV
      </button>
    </form>
    <div id="loader" class="mt-6 hidden">
      <div class="spinner"></div>
      <p class="mt-2 text-blue-600 font-medium" id="analyzing-label">Analyserar CV...</p>
    </div>
  </section>

  <!-- Results -->
  <section id="matches" class="max-w-4xl mx-auto mt-10 hidden px-4">
    <h2 class="text-2xl font-bold mb-6" id="match-title">Matchade Jobb</h2>
    <div id="job-count" class="text-sm text-gray-500 mb-4"></div>
    <div id="job-list" class="space-y-6"></div>
  </section>

  <!-- Back to top -->
  <div id="back-to-top" title="Till toppen">‚¨Ü</div>

  <script>
    const $ = id => document.getElementById(id);

    // Elementreferenser
    const dropArea = $("drop-area"),
          input    = $("cv"),
          label    = $("drop-label"),
          form     = $("cv-form"),
          loader   = $("loader"),
          matches  = $("matches"),
          jobList  = $("job-list"),
          jobCount = $("job-count"),
          topBtn   = $("back-to-top");

    // Text f√∂r svenska och engelska
    const text = {
      sv: {
        drop:      "Sl√§pp ditt CV h√§r eller klicka f√∂r att ladda upp",
        analyzing: "Analyserar CV...",
        matches:   "Matchade Jobb",
        showing:   (x,y) => `Visar ${x} av ${y} jobb`
      },
      en: {
        drop:      "Drop your CV here or click to upload",
        analyzing: "Analyzing your CV...",
        matches:   "Matched Jobs",
        showing:   (x,y) => `Showing ${x} of ${y} jobs`
      }
    };
    const lang = (navigator.language||"sv").slice(0,2);
    const t = text[lang] || text.sv;

    // Initiera UI-texts
    label.textContent          = t.drop;
    $("analyzing-label").textContent = t.analyzing;
    $("match-title").textContent     = t.matches;

    // Drag & drop
    ["dragover","dragleave","drop"].forEach(evt=>
      dropArea.addEventListener(evt, e=>{
        e.preventDefault();
        dropArea.classList.toggle("dragover", evt==="dragover");
      })
    );
    dropArea.addEventListener("click", ()=> input.click());
    input.addEventListener("change", ()=>{
      if(input.files.length) label.textContent = input.files[0].name;
    });
    dropArea.addEventListener("drop", e=>{
      const file = e.dataTransfer.files[0];
      if(!file) return;
      const dt = new DataTransfer();
      dt.items.add(file);
      input.files = dt.files;
      label.textContent = file.name;
    });

    // Scroll-to-top
    window.addEventListener("scroll", ()=>{
      topBtn.style.display = window.scrollY>300 ? "block" : "none";
    });
    topBtn.addEventListener("click", ()=>{
      window.scrollTo({top:0, behavior:"smooth"});
    });

    // Form-submit
    form.addEventListener("submit", async e=>{
      e.preventDefault();
      const file = input.files[0];
      if(!file) return;

      loader.classList.remove("hidden");
      matches.classList.add("hidden");
      jobList.innerHTML = "";
      jobCount.textContent = "";

      const formData = new FormData();
      formData.append("cv", file);

      try {
        const res  = await fetch("http://127.0.0.1:8000/match", { method:"POST", body: formData });
        const data = await res.json();
        loader.classList.add("hidden");

        if(!res.ok){
          alert(data.detail||"N√•got gick fel");
          return;
        }

        matches.classList.remove("hidden");
        jobCount.textContent = t.showing(data.filtered, data.total_found);
        const defaultLogo = "https://via.placeholder.com/64?text=Logo";

        data.matches.forEach(job=>{
          const logoUrl = job.logo || defaultLogo;
          const desc    = job.description.length>350
                         ? job.description.slice(0,350)+"..."
                         : job.description;

          const card = document.createElement("div");
          card.className = "bg-white shadow rounded p-4";

          card.innerHTML = `
            <img src="${logoUrl}"
                 onerror="this.src='${defaultLogo}'"
                 class="h-16 mb-2"
                 alt="Logo">
            <h3 class="font-bold text-lg">
              ${job.title} @ ${job.company}
            </h3>
            <p class="text-sm text-gray-600 mb-1">üìç ${job.location}</p>
            <p class="text-xs italic text-gray-500 mb-2">
              Fr√•n ${job.source}
            </p>
            <div class="grid grid-cols-3 gap-2 mb-2 text-xs">
              ${["ats","keywords","format"].map(key=>`
                <div>
                  <div class="font-semibold">${key.toUpperCase()}</div>
                  <div class="bg-gray-200 w-full h-2 rounded overflow-hidden">
                    <div class="bg-blue-500 h-2 transition-all"
                         style="width:${job[key]}%"></div>
                  </div>
                  <div>${job[key]}%</div>
                </div>
              `).join("")}
            </div>
            <p class="text-sm mb-2">${desc}</p>
            <a href="${job.url}"
               class="text-blue-600 text-sm underline"
               target="_blank">Se jobbannons</a>
          `;

          jobList.appendChild(card);
        });

      } catch(err){
        loader.classList.add("hidden");
        alert("Serverfel");
        console.error(err);
      }
    });
  </script>
</body>
</html>
